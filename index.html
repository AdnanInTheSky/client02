<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BioNova - Sustainable Development NGO</title>
    
    <!-- Bootstrap 5 CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* Minimal custom CSS - only what's essential */
        .hero {
            padding: 8rem 0;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .section {
            padding: 5rem 0;
        }

        /* Ensure images fill card tops properly */
        .card-img-top {
            height: 200px;
            width: 100%;
            object-fit: cover;
            object-position: center;
        }

        .team-card .card-img-top {
            height: 250px;
            object-fit: cover;
            object-position: center;
        }

        /* Loading animation */
        .loading {
            text-align: center;
            padding: 2rem;
        }

        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #000;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Background toggle */
        .bg-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            background: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .bg-toggle button {
            margin: 0 5px;
            padding: 5px 10px;
            border: 1px solid #ddd;
            background: white;
            cursor: pointer;
        }

        .bg-toggle button.active {
            background: #000;
            color: white;
        }
    </style>
</head>

<body>
    <!-- Navigation -->
    <header>
        <nav class="navbar navbar-expand-lg navbar-light fixed-top bg-white shadow-sm">
            <div class="container">
                <a class="navbar-brand fw-bold" href="index.html">BioNova</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="services.html">About</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="articles.html">Publications</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="team.html">Team</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="contact.html">Contact</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <main id="main-content">
        <section class="hero" id="hero-section" aria-labelledby="hero-heading"
                 style="background: linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.4)), url('content/images/tester.jpg'); background-size: cover; background-position: center; color: white;">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-8">
                        <h1 id="hero-heading" class="display-4 fw-bold mb-4">Sustainable Solutions for Global Challenges</h1>
                        <p class="lead mb-4">Empowering communities through innovative development programs and strategic partnerships</p>
                        <button class="btn btn-dark btn-lg me-2" onclick="window.location.href='contact.html'">Join Our Mission</button>
                        <button class="btn btn-outline-light btn-lg" onclick="window.location.href='services.html'">Learn More</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- About Section -->
        <section class="py-5 bg-light" aria-labelledby="about-heading">
            <div class="container">
                <div class="card border-0 shadow-lg rounded-4 overflow-hidden">
                    <div class="row g-0 align-items-center">
                        <!-- Text Content -->
                        <div class="col-lg-6 p-5">
                            <header class="mb-4">
                                <h2 id="about-heading" class="display-6 fw-bold mb-3">
                                    Our Commitment to Sustainable Change
                                </h2>
                                <p class="text-muted">
                                    Building resilient communities through evidence-based approaches and collaborative partnerships
                                </p>
                            </header>
                            <p class="mb-3">
                                BioNova is an international non-governmental organization dedicated to creating lasting, sustainable change in communities worldwide.
                            </p>
                            <p class="mb-3">
                                Our mission focuses on empowering communities through capacity building, education, healthcare access, and economic development initiatives.
                            </p>
                            <p class="mb-4">
                                We prioritize local leadership and participatory approaches to ensure programs are culturally appropriate and sustainable.
                            </p>
                            <a href="services.html" class="btn btn-dark">
                                Explore Our Impact <i class="fas fa-arrow-right ms-2"></i>
                            </a>
                        </div>

                        <!-- Image -->
                        <div class="col-lg-6">
                            <img
                                src="content/images/teamBio.jpeg"
                                alt="BioNova team collaborating"
                                class="img-fluid w-100 h-100 object-fit-cover"
                                loading="lazy"
                            />
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Articles Section -->
        <section class="section bg-light" aria-labelledby="articles-heading">
            <div class="container">
                <header class="text-center mb-5">
                    <h2 id="articles-heading" class="display-5 fw-bold">Insights & Impact Stories</h2>
                    <p class="text-muted">Research findings, program updates, and stories of transformation</p>
                </header>
                <div class="row g-4" id="articles-container">
                    <div class="col-12 text-center">
                        <div class="loading">
                            <div class="spinner"></div>
                            <p>Loading articles...</p>
                        </div>
                    </div>
                </div>
                <div class="text-center mt-5">
                    <a href="articles.html" class="btn btn-outline-dark">View All Publications <i class="fas fa-arrow-right ms-2"></i></a>
                </div>
            </div>
        </section>

        <!-- Team Section -->
        <section class="section" aria-labelledby="team-heading">
            <div class="container">
                <header class="text-center mb-5">
                    <h2 id="team-heading" class="display-5 fw-bold">Our Leadership & Experts</h2>
                    <p class="text-muted">Dedicated professionals driving sustainable change</p>
                </header>
                <div class="row g-4" id="team-container">
                    <div class="col-12 text-center">
                        <div class="loading">
                            <div class="spinner"></div>
                            <p>Loading team...</p>
                        </div>
                    </div>
                </div>
                <div class="text-center mt-5">
                    <a href="team.html" class="btn btn-outline-dark">Meet Our Full Team <i class="fas fa-arrow-right ms-2"></i></a>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-dark text-white py-4">
        <div class="container text-center">
            <p>&copy; 2025 BioNova. All rights reserved.</p>
        </div>
    </footer>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Script (with critical fixes applied) -->
    <script>
        // Utility function for parsing YAML frontmatter
        function parseYAML(yamlStr) {
            const result = {};
            const lines = yamlStr.trim().split('\n');
            for (const line of lines) {
                const [key, ...valueParts] = line.split(':');
                const trimmedKey = key.trim();
                let value = valueParts.join(':').trim();
                if (value.startsWith('"') && value.endsWith('"')) {
                    value = value.slice(1, -1);
                } else if (value.startsWith("'") && value.endsWith("'")) {
                    value = value.slice(1, -1);
                } else if (value.startsWith('[') && value.endsWith(']')) {
                    value = value.slice(1, -1).split(',').map(v => v.trim().replace(/"/g, '').replace(/'/g, ''));
                }
                result[trimmedKey] = value;
            }
            return result;
        }

        // Function to convert markdown to HTML (simplified)
        function simpleMarkdownToHTML(md) {
            let html = md;
            html = html.replace(/^(\s*)## (.+)$/gm, '$1<h2>$2</h2>');
            html = html.replace(/^(\s*)# (.+)$/gm, '$1<h1>$2</h1>');
            html = html.replace(/^(\s*)### (.+)$/gm, '$1<h3>$2</h3>');
            html = html.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
            html = html.replace(/\*(.+?)\*/g, '<em>$1</em>');
            html = html.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank">$1</a>');
            html = html.replace(/^- (.+)$/gm, '<li>$1</li>');
            html = html.replace(/(<li>.+<\/li>)+/g, '<ul>$&</ul>');
            html = html.replace(/\n/g, '<br>');
            const paragraphs = html.split('<br><br>');
            html = paragraphs.map(p => `<p>${p}</p>`).join('');
            html = html.replace(/<br><br>/g, '<br>');
            return html;
        }

        // Main function to load content
        async function loadIndexContent() {
            try {
                const indexResponse = await fetch('/content/index.json');
                if (!indexResponse.ok) {
                    throw new Error(`HTTP error! status: ${indexResponse.status}`);
                }
                const indexData = await indexResponse.json();

                // Load latest 3 articles
                const articleFiles = indexData.articles.slice(0, 3);
                const articlePromises = articleFiles.map(file =>
                    fetch(`/content/${file}`)
                        .then(r => {
                            if (!r.ok) throw new Error(`Failed to load article: ${file}`);
                            return r.text();
                        })
                        .catch(err => {
                            console.error(`Error loading article ${file}:`, err);
                            return null;
                        })
                );

                const articleTexts = await Promise.all(articlePromises);
                const validArticleTexts = articleTexts.filter(text => text !== null);
                const articleCards = [];
                for (let i = 0; i < validArticleTexts.length; i++) {
                    const text = validArticleTexts[i];
                    const parts = text.split('---');
                    if (parts.length >= 3) {
                        const frontmatter = parts[1];
                        const body = parts.slice(2).join('---');
                        const meta = parseYAML(frontmatter);
                        const plainText = body.replace(/[#*_\-[\]()`]/g, '').substring(0, 150) + '...';
                        articleCards.push(`
                            <div class="col-md-4 shadow-sm">
                                <div class="card h-100 shadow-sm" style="max-width: 350px; margin: 0 auto;">
                                    <img src="${meta.image || 'https://via.placeholder.com/800x500/e2e8f0/64748b?text=Article+Image'}" 
                                         class="card-img-top" 
                                         alt="${meta.title}" 
                                         loading="lazy">
                                    <div class="card-body d-flex flex-column">
                                        <h5 class="card-title">${meta.title}</h5>
                                        <p class="card-text flex-grow-1">${plainText}</p>
                                        <button class="btn btn-outline-dark mt-auto" onclick="openDetail('${articleFiles[i]}', 'article')">Read More</button>
                                    </div>
                                </div>
                            </div>
                        `);
                    }
                }

                const articlesContainer = document.getElementById('articles-container');
                if (articleCards.length) {
                    articlesContainer.innerHTML = articleCards.join('');
                } else {
                    articlesContainer.innerHTML = '<div class="col-12"><p class="text-center text-muted">No articles available at this time.</p></div>';
                }

                // Load team members
                const teamFiles = indexData.teams.slice(0, 3);
                const teamPromises = teamFiles.map(file =>
                    fetch(`/content/${file}`)
                        .then(r => {
                            if (!r.ok) throw new Error(`Failed to load team member: ${file}`);
                            return r.text();
                        })
                        .catch(err => {
                            console.error(`Error loading team member ${file}:`, err);
                            return null;
                        })
                );

                const teamTexts = await Promise.all(teamPromises);
                const validTeamTexts = teamTexts.filter(text => text !== null);
                const teamCards = [];
                for (let i = 0; i < validTeamTexts.length; i++) {
                    const text = validTeamTexts[i];
                    const parts = text.split('---');
                    if (parts.length >= 3) {
                        const frontmatter = parts[1];
                        const body = parts.slice(2).join('---');
                        const meta = parseYAML(frontmatter);
                        const excerpt = body.replace(/[#*_\-[\]()`]/g, '').substring(0, 100) + '...';
                        teamCards.push(`
                            <div class="col-md-4 shadow-sm">
                                <div class="card team-card h-100 shadow-sm" style="max-width: 350px; margin: 0 auto;">
                                    <img src="${meta.image || 'https://via.placeholder.com/800x500/e2e8f0/64748b?text=Team+Member'}" 
                                         class="card-img-top" 
                                         alt="${meta.title}" 
                                         loading="lazy">
                                    <div class="card-body d-flex flex-column">
                                        <h5 class="card-title">${meta.title}</h5>
                                        <p class="card-text"><strong>${meta.role || 'Team Member'}</strong></p>
                                        <p class="card-text flex-grow-1">${excerpt}</p>
                                        <button class="btn btn-outline-dark mt-auto" onclick="openDetail('${teamFiles[i]}', 'team')">View Profile</button>
                                    </div>
                                </div>
                            </div>
                        `);
                    }
                }

                const teamContainer = document.getElementById('team-container');
                if (teamCards.length) {
                    teamContainer.innerHTML = teamCards.join('');
                } else {
                    teamContainer.innerHTML = '<div class="col-12"><p class="text-center text-muted">No team members available at this time.</p></div>';
                }
            } catch (error) {
                console.error('Error loading index content:', error);
                document.getElementById('articles-container').innerHTML = '<div class="col-12"><p class="text-center text-danger">Unable to load articles at this time.</p></div>';
                document.getElementById('team-container').innerHTML = '<div class="col-12"><p class="text-center text-danger">Unable to load team information at this time.</p></div>';
            }
        }

        // Function to open detail pages
        function openDetail(id, type) {
            sessionStorage.setItem('selectedFile', id);
            if (type === 'article') {
                window.location.href = 'article.html';
            } else if (type === 'team') {
                window.location.href = 'team_detail.html';
            }
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', loadIndexContent);
    </script>
</body>
</html>